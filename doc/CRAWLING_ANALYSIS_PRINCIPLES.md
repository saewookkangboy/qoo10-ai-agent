# Qoo10 크롤링 및 분석 원칙 문서

## 📋 목적

이 문서는 Qoo10 상품 및 Shop 페이지 크롤링과 분석 과정에서 일관된 기준과 원칙을 제공합니다. 모든 분석 및 분석 리포트는 이 원칙을 기반으로 생성됩니다.

---

## 🎯 크롤링 원칙

### 1. 크롤링 방법 우선순위

1. **Playwright 크롤링 (기본 권장)**
   - JavaScript 실행 환경에서 동적 콘텐츠 추출
   - 동적으로 로드되는 콘텐츠 (이미지, 리뷰, 가격 등) 추출에 효과적
   - 사용법: `crawler.crawl_product(url, use_playwright=True)`
   - 사용법: `crawler.crawl_shop(url, use_playwright=True)`

2. **HTTP 크롤링 (Fallback)**
   - Playwright가 사용 불가능한 경우 사용
   - 정적 콘텐츠 위주로 추출 가능
   - 사용법: `crawler.crawl_product(url, use_playwright=False)`

### 2. 데이터 추출 기준

#### 2.1 상품 페이지 크롤링 필수 항목

| 항목 | 필수 여부 | 추출 방법 | 검증 기준 |
|------|----------|----------|----------|
| **상품명** | 필수 | `_extract_product_name()` | 3자 이상, 의미 있는 텍스트 |
| **상품 코드** | 필수 | `_extract_product_code()` | 숫자 형식 |
| **가격 정보** | 필수 | `_extract_price()` | 판매가 필수, 정가 선택 |
| **이미지** | 필수 | `_extract_images()` | 썸네일 필수, 상세 이미지 선택 |
| **상품 설명** | 권장 | `_extract_description()` | 50자 이상 권장 |
| **리뷰 정보** | 권장 | `_extract_reviews()` | 평점, 리뷰 수 |
| **판매자 정보** | 필수 | `_extract_seller_info()` | Shop ID 필수 |
| **배송 정보** | 필수 | `_extract_shipping_info()` | 배송비 또는 무료배송 정보 |
| **쿠폰 정보** | 선택 | `_extract_coupon_info()` | 쿠폰 존재 여부 |
| **Qポイント 정보** | 선택 | `_extract_qpoint_info()` | 포인트 정보 |

#### 2.2 Shop 페이지 크롤링 필수 항목

| 항목 | 필수 여부 | 추출 방법 | 검증 기준 |
|------|----------|----------|----------|
| **Shop ID** | 필수 | `_extract_shop_id()` | URL에서 추출 |
| **Shop명** | 필수 | `_extract_shop_name()` | 2자 이상 |
| **Shop 레벨** | 권장 | `_extract_shop_level()` | power/excellent/normal |
| **팔로워 수** | 필수 | `_extract_follower_count()` | 0 이상 정수 |
| **상품 수** | 필수 | `_extract_product_count()` | 0 이상 정수 |
| **상품 목록** | 권장 | `_extract_shop_products()` | 최소 1개 이상 |
| **카테고리 분포** | 선택 | `_extract_shop_categories()` | 카테고리별 상품 수 |
| **쿠폰 정보** | 선택 | `_extract_shop_coupons()` | 쿠폰 목록 |

### 3. 데이터 검증 원칙

#### 3.1 가격 정보 검증

- **판매가**: 100円 ~ 10,000,000円 범위 (합리적인 범위)
- **정가**: 판매가보다 높거나 같아야 함
- **할인율**: 0% ~ 99% 범위 (100% 이상은 오류로 간주)
- **가격 형식**: 숫자만 허용, 쉼표 제거 후 숫자로 변환

#### 3.2 이미지 정보 검증

- **썸네일**: 필수, URL 형식 검증
- **상세 이미지**: URL 형식 검증, 중복 제거
- **이미지 URL**: `http://` 또는 `https://`로 시작해야 함

#### 3.3 리뷰 정보 검증

- **평점**: 0.0 ~ 5.0 범위
- **리뷰 수**: 0 이상 정수
- **리뷰 텍스트**: 10자 이상 권장

#### 3.4 Shop 정보 검증

- **팔로워 수**: 0 이상 정수
- **상품 수**: 0 이상 정수
- **Shop 레벨**: power/excellent/normal/unknown 중 하나

---

## 📊 분석 원칙

### 1. 분석 기준 통일

모든 분석 리포트는 다음 기준을 따라야 합니다:

#### 1.1 상품 분석 기준

**이미지 분석**
- 썸네일 존재 여부: 필수
- 상세 이미지 개수: 5개 이상 권장
- 점수 계산: 0-100점 (기준: 이미지 개수 및 품질)

**상품 설명 분석**
- 설명 길이: 500자 이상 권장
- SEO 키워드: 검색어 포함 여부
- 점수 계산: 0-100점 (기준: 길이, 키워드 포함 여부)

**가격 전략 분석**
- 경쟁사 대비 가격 포지셔닝
- 할인율: 10-30% 권장 범위
- 점수 계산: 0-100점 (기준: 경쟁사 대비 포지셔닝)

**리뷰 분석**
- 평점: 4.0 이상 권장
- 리뷰 수: 10개 이상 권장
- 점수 계산: 0-100점 (기준: 평점 및 리뷰 수)

#### 1.2 Shop 분석 기준

**Shop 레벨 분석**
- POWER 레벨: 90% 이상 = power, 70-89% = excellent, 70% 미만 = normal
- 팔로워 수: 많을수록 좋음 (점수화)
- 상품 수: 다양할수록 좋음 (점수화)

**카테고리 분포 분석**
- 카테고리 다양성: 다양한 카테고리 = 좋음
- 주력 카테고리 집중도: 특정 카테고리 집중 = 전략적 포지셔닝

**상품 라인업 분석**
- 가격대 분포: 균형 잡힌 가격대 = 좋음
- 상품 타입 다양성: 다양한 타입 = 좋음

### 2. 데이터 일관성 유지

#### 2.1 크롤링 결과 표시

모든 크롤링 결과에는 `crawled_with` 필드를 포함해야 합니다:
- `crawled_with: "playwright"` - Playwright 사용
- `crawled_with: "httpx"` - HTTP 크롤링 사용

#### 2.2 누락 데이터 처리

- 필수 항목 누락: 분석 중단 또는 오류 반환
- 권장 항목 누락: 기본값 사용 (0, null, 빈 문자열 등)
- 선택 항목 누락: 무시하고 계속 진행

#### 2.3 데이터 정규화

- **가격**: 정수로 변환 (쉼표 제거)
- **텍스트**: 앞뒤 공백 제거
- **URL**: 절대 URL로 변환 (상대 URL → 절대 URL)
- **날짜**: ISO 8601 형식 또는 표준 형식

---

## 🔧 크롤링 개선 사항 (Playwright 버전 반영)

### 1. 동적 콘텐츠 처리

Playwright 크롤링에서 성공적으로 추출된 항목:
- ✅ **이미지**: 21개 상세 이미지 (기존 HTTP: 0개)
- ✅ **리뷰**: 평점 4.8, 리뷰 수 19개 (기존 HTTP: 0개)
- ✅ **상품 설명**: 123자 (기존 HTTP: 0자)
- ✅ **페이지 구조**: 213개 div 클래스 (기존 HTTP: 3개)

**적용 원칙**: 동적 콘텐츠가 필요한 경우 Playwright 사용 권장

### 2. JavaScript 데이터 추출

Playwright 크롤링에서는 페이지에서 직접 JavaScript를 실행하여 데이터를 추출할 수 있습니다:
- 상품명: `document.querySelector('h1')`
- 가격 정보: `document.querySelectorAll('[class*="price"]')`
- 리뷰 수: 정규식으로 `レビュー\s*(\d+)` 패턴 추출
- 평점: `(\d+\.?\d*)\s*\((\d+)\)` 패턴 추출

**적용 원칙**: HTML 파싱으로 추출 실패 시 JavaScript 실행으로 보완

### 3. 스크롤 처리

동적으로 로드되는 콘텐츠를 위해 스크롤 처리:
- 최대 5,000px (상품 페이지) 또는 10,000px (Shop 페이지)까지 스크롤
- `networkidle` 상태까지 대기

**적용 원칙**: 지연 로딩된 콘텐츠를 위해 충분한 스크롤 시간 확보

---

## 📝 분석 리포트 생성 기준

### 1. 리포트 구조

모든 분석 리포트는 다음 구조를 따라야 합니다:

```json
{
  "crawled_data": {
    "crawled_with": "playwright" | "httpx",
    "product_code": "string",
    "product_name": "string",
    // ... 기타 크롤링 데이터
  },
  "analysis": {
    "image_analysis": {
      "score": 0-100,
      "grade": "Excellent" | "Good" | "Fair" | "Poor",
      "details": {},
      "recommendations": []
    },
    "description_analysis": {
      "score": 0-100,
      "grade": "Excellent" | "Good" | "Fair" | "Poor",
      "details": {},
      "recommendations": []
    },
    // ... 기타 분석 결과
  },
  "overall_score": 0-100,
  "overall_grade": "Excellent" | "Good" | "Fair" | "Poor",
  "recommendations": [
    // 개선 제안 목록
  ]
}
```

### 2. 점수 계산 기준

**⚠️ 중요**: 상세한 점수 계산 기준은 `ENHANCED_ANALYSIS_METRICS.md` 문서를 참조하세요.

#### 2.1 기본 점수 계산 원칙

- 모든 점수는 0-100점 범위
- 각 항목별 가중치 적용
- 등급 시스템 적용 (Excellent/Good/Fair/Poor)
- 벤치마크 기준 준수

#### 2.2 간략한 점수 기준 (상세는 ENHANCED_ANALYSIS_METRICS.md 참조)

**이미지 점수 (0-100점):**
- 썸네일 존재 및 품질 (25%)
- 상세 이미지 개수 (35%)
- 이미지 다양성 (20%)
- 이미지 품질 (20%)

**상품 설명 점수 (0-100점):**
- 설명 길이 (35%)
- 구조화 품질 (25%)
- SEO 키워드 (20%)
- 일본어 품질 (20%)

**가격 점수 (0-100점):**
- 경쟁사 대비 포지셔닝 (40%)
- 할인율 적정성 (25%)
- 가격 심리학 (20%)
- 가격 일관성 (15%)

**리뷰 점수 (0-100점):**
- 평점 (45%)
- 리뷰 수 (30%)
- 부정 리뷰 비율 (15%)
- 리뷰 품질 (10%)

### 3. 등급 시스템

| 등급 | 점수 범위 | 설명 |
|------|----------|------|
| **Excellent** | 90-100점 | 최우수, 벤치마크 수준 |
| **Good** | 70-89점 | 우수, 개선 여지 있음 |
| **Fair** | 50-69점 | 보통, 개선 필요 |
| **Poor** | 0-49점 | 미흡, 즉시 개선 필요 |

### 4. 리포트 일관성 유지

- 모든 리포트는 동일한 점수 계산 기준 사용
- `ENHANCED_ANALYSIS_METRICS.md`의 고도화된 지표 적용
- 크롤링 방법(`crawled_with`) 명시
- 데이터 출처 명확히 표시
- 누락 데이터는 명시적으로 표시 (null, 0, "N/A" 등)
- 등급(Grade) 명시

---

## ✅ 체크리스트

크롤링 및 분석 전 확인 사항:

- [ ] 크롤링 방법 선택 (Playwright 권장)
- [ ] 필수 항목 추출 확인
- [ ] 데이터 검증 (가격, 이미지, 리뷰 등)
- [ ] 누락 데이터 처리
- [ ] 분석 기준 적용
- [ ] 리포트 구조 준수
- [ ] 점수 계산 기준 적용
- [ ] 일관성 검증

---

## 📚 관련 문서

- **ENHANCED_ANALYSIS_METRICS.md**: 고도화된 분석 지표 체계 (상세 점수 계산 기준)
- **ANALYSIS_PRINCIPLES_IMPLEMENTATION.md**: 분석 원칙 적용 가이드

## 📌 변경 이력

- **2026-01-14**: 초기 버전 작성 (Playwright 크롤링 반영)
- **2026-01-14**: 고도화된 지표 체계 반영 (ENHANCED_ANALYSIS_METRICS.md 참조)

---

**참고**: 이 원칙은 지속적으로 업데이트되며, 모든 크롤링 및 분석 코드는 이 원칙을 준수해야 합니다. 상세한 점수 계산 기준은 `ENHANCED_ANALYSIS_METRICS.md`를 참조하세요.
